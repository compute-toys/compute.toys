-- CREATE INDEX refresh_token_session_id ON auth.refresh_tokens USING btree (session_id);

-- set check_function_bodies = off;

-- CREATE OR REPLACE FUNCTION auth.email()
--  RETURNS text
--  LANGUAGE sql
--  STABLE
-- AS $function$
--   select 
--   	coalesce(
-- 		nullif(current_setting('request.jwt.claim.email', true), ''),
-- 		(nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'email')
-- 	)::text
-- $function$
-- ;

-- CREATE OR REPLACE FUNCTION auth.role()
--  RETURNS text
--  LANGUAGE sql
--  STABLE
-- AS $function$
--   select 
--   	coalesce(
-- 		nullif(current_setting('request.jwt.claim.role', true), ''),
-- 		(nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'role')
-- 	)::text
-- $function$
-- ;

-- CREATE OR REPLACE FUNCTION auth.uid()
--  RETURNS uuid
--  LANGUAGE sql
--  STABLE
-- AS $function$
--   select 
--   	coalesce(
-- 		nullif(current_setting('request.jwt.claim.sub', true), ''),
-- 		(nullif(current_setting('request.jwt.claims', true), '')::jsonb ->> 'sub')
-- 	)::uuid
-- $function$
-- ;

CREATE TRIGGER on_auth_user_created_private AFTER INSERT ON auth.users FOR EACH ROW EXECUTE FUNCTION handle_new_user_private();


